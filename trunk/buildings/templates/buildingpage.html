{% extends "sitebase.html" %}
{% block title %}{{ BUILDING_NAME }} Energy Portal{% endblock %}

{% block extra_scriptsCSS_imports %}
<link href="/site-media/anytime/anytimec.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="/site-media/flot/jquery.flot.js"></script>
<script type="text/javascript" src="/site-media/flot/jquery.flot.stack.min.js"></script>
<script type="text/javascript" src="/site-media/flot/jquery.flot.navigate.min.js"></script>
<script type="text/javascript" src="/site-media/flot/jquery.flot.selection.min.js"></script>
<script type="text/javascript" src="/site-media/anytime/anytimec.js"></script>
{% endblock %}

{% block extra_css_inline %}


	.hero-unit {
		padding-top: 20px;
		padding-bottom: 20px;
		padding-right: 20px;
		padding-left: 20px;


	}

	footer {
		 margin-top: 0px; 
	}
{% endblock %}
{% block header_title %}
{{ BUILDING_NAME }} Energy Portal
{% endblock %}
{% block header_subtitle %}
Drag on the graph to zoom in.
{% endblock %}

{% block content_inside %}
<div class="hero-unit">

			

<p>Live Energy Usage Graph (Default Past 6 Hours): </p> Start Time: <input class="span4" type = "text" id="date2" size=36>&nbsp; &nbsp; &nbsp; &nbsp;  End Time: <input class="span4" type="text" id="date" size=36>&nbsp; &nbsp; &nbsp; &nbsp; <input type = "button" value = "Load/Refresh Data" id="refresh"> 
<br><br>
<div id="graph" ><div style="float:left;position:relative;top:220px;left:-50px;-moz-transform:rotate(270deg);-o-transform:rotate(270deg);-webkit-transform:rotate(270deg);filter:progid:DXImageTransform.Microsoft.BasicImage(rotation=3);-ms-filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation=3);">Energy Usage (kW)</div> <!-- rotated-text code adapted from http://stackoverflow.com/a/4809513 -->
<!-- contains graph generated by flot -->
<div id="placeholder" style = "position:relative;margin-left:30px;width:850px;height:500px;"></div><div id="bottomtext" style="position:relative;text-align:center;">Time</div>
</div>
</div>





<div class="row">
<div class="span8" style="text-align:center;">
<ul class="media-grid">

        <li>
          <a href="{{ PIC_SRC }}">
            <img class="thumbnail" src="{{ PIC }}" alt="">
          </a>
        </li>
              </ul>

<h6><a href="{{ PIC_SRC }}">Image Source</a></h6>
</div>
<div class="span8">
<h2>About {{ BUILDING_NAME }}:</h2> <p>{{ INFO }} </p><br> <br>
<div style="text-align:right;"><a href="{{ STATS_ALTINFO }}" class="btn large primary">More Info >></a></div>

<h2>Building Stats:</h2> 
<ul>
<li>SqFT: {{ STATS_SQFT }} </li>
<li>Year Built: {{ STATS_YEAR }} </li>
<li>Available Data Sources: {{ UUID_COUNT }} </li>
</ul>

</div>
</div>
<div class="row">
<div class="span16">
<h2>Techie Stuff:</h2>
</div>
</div>
<div class="row">
<div class="span8">
UUID_0: {{ UUID_0 }} <br>
UUID_0s30: {{ UUID_0s30 }} <br>
UUID_0s36: {{ UUID_0s36 }} <br>
UUID_1: {{ UUID_1 }} <br>
UUID_1s30: {{ UUID_1s30 }} <br>
UUID_1s36: {{ UUID_1s36 }} <br>
UUID_2: {{ UUID_2 }} <br>
UUID_2s30: {{ UUID_2s30 }} <br>
UUID_2s36: {{ UUID_2s36 }} <br>
</div>
<div class="span8">
UUID_3: {{ UUID_3 }} <br>
UUID_3s30: {{ UUID_3s30 }} <br>
UUID_3s36: {{ UUID_3s36 }} <br>
UUID_4: {{ UUID_4 }} <br>
UUID_4s30: {{ UUID_4s30 }} <br>
UUID_4s36: {{ UUID_4s36 }} <br>
UUID_5: {{ UUID_5 }} <br>
UUID_5s30: {{ UUID_5s30 }} <br>
UUID_5s36: {{ UUID_5s36 }} <br>
</div>
</div>
<br><br>
{% endblock %}

{% block random_extras %}
<script type="text/javascript">
//time setup
var datefmt = "%W %M %e, %Y %H:%i";
var converter = new AnyTime.Converter( { format: datefmt });
var nowDate = new Date();
$("#date").val(converter.format(nowDate));
var startDate = new Date();
startDate.setTime(nowDate - 21600000);
$("#date2").val(converter.format(startDate));
AnyTime.picker( "date", { format: datefmt, firstDOW: 0 } );
AnyTime.picker( "date2", { format: datefmt, firstDOW: 0 } );
//end time setup

$(document).ready(function() {
	getData();
});

$("#refresh").click(function() {
	getData();
});

function getData(){
	var converter = new AnyTime.Converter( { format: datefmt });
	var endtime = converter.parse($("#date").val()).getTime();
	var starttime = converter.parse($("#date2").val()).getTime();

	$.ajax({ //async needs to be off
		async: false,
		type: 'GET',
		url: "/ARDgetData/api/data/uuid/" + escape( '{{ UUID_0 }}' ) + "?starttime=" + escape(starttime) + "&endtime=" + escape(endtime),
		success: function(resp) {
			latest = [];
			latest = eval(resp);
			drawGraph(latest);
		}
	});
}

function drawGraph(inputData){
	
	var data = [ inputData[0]['Readings'] ];
	
	var options = {
        	series: {
            	lines: { show: true },
				color: "blue",
        	},
        	legend: { noColumns: 2 },
        	xaxis: { tickDecimals: 0, mode:"time" },
        	selection: { mode: "x" }
    	};

	var placeholder = $("#placeholder");

	placeholder.bind("plotselected", function (event, ranges) {
		$("#selection").text(ranges.xaxis.from.toFixed(1) + " to " + ranges.xaxis.to.toFixed(1));
		plot = $.plot(placeholder, data, $.extend(true, {}, options, { xaxis: { min: ranges.xaxis.from, max: ranges.xaxis.to } }));
	});

	placeholder.bind("plotunselected", function (event) {
		$("#selection").text("");
	});

	var plot = $.plot(placeholder, data, options);
}
</script>
{% endblock %}
